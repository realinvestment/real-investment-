<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Football Betting Game</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #eee;
    }
    header {
      background: #1f1f1f;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.7);
      flex-wrap: wrap;
      gap: 10px;
    }
    header h1 {
      font-size: 1.5rem;
      margin: 0;
      flex-grow: 1;
    }
    .balance {
      background: #333;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      color: #8bc34a;
      min-width: 220px;
      text-align: center;
    }
    .currency-toggle {
      background: #444;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      font-size: 0.9rem;
      color: #ccc;
    }
    .currency-toggle div {
      padding: 8px 15px;
      flex-grow: 1;
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }
    .currency-toggle .active {
      background: #8bc34a;
      color: #121212;
    }
    main {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    .match-card {
      background: #1f1f1f;
      margin-bottom: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.8);
    }
    .teams {
      display: flex;
      justify-content: space-between;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .match-info {
      color: #bbb;
      margin-bottom: 10px;
    }
    .bet-section select,
    .bet-section input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .bet-btn {
      background: #8bc34a;
      color: #121212;
      font-weight: bold;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }
    .result-message {
      margin-top: 10px;
      font-size: 0.95rem;
    }
    .history {
      background: #1f1f1f;
      padding: 20px;
      margin: 20px auto;
      border-radius: 10px;
      max-width: 900px;
      box-shadow: 0 0 8px rgba(0,0,0,0.8);
      word-break: break-word;
    }
    .history h2 {
      color: #8bc34a;
    }
    .history-item {
      padding: 8px 0;
      border-bottom: 1px solid #444;
    }
  </style>
</head>
<body>

<header>
  <h1>Football Betting</h1>
  <div class="balance" id="balanceDisplay">Balance: USDT 0.00 | TZS 0.00</div>
  <div class="currency-toggle" id="currencyToggle">
    <div id="usdtBtn" class="active">Bet in USDT</div>
    <div id="tzsBtn">Bet in TZS</div>
  </div>
</header>

<main id="matchesContainer"></main>

<section class="history" id="historySection" style="display:none;">
  <h2>Bet History</h2>
  <div id="betHistoryList"></div>
</section>

<script>
  const matches = [
    {
      id: 1,
      teamA: 'Simba SC',
      teamB: 'Young Africans',
      time: 'Tomorrow 3:00 PM',
      odds: { teamA: 2.1, draw: 3.5, teamB: 2.8 }
    },
    {
      id: 2,
      teamA: 'Liverpool',
      teamB: 'Manchester United',
      time: 'Today 9:00 PM',
      odds: { teamA: 2.5, draw: 3.2, teamB: 2.4 }
    }
  ];

  const TZS_RATE = 2600; // 1 USDT = 2600 TZS fixed conversion rate

  const balanceDisplay = document.getElementById('balanceDisplay');
  const matchesContainer = document.getElementById('matchesContainer');
  const betHistoryList = document.getElementById('betHistoryList');
  const historySection = document.getElementById('historySection');

  const usdtBtn = document.getElementById('usdtBtn');
  const tzsBtn = document.getElementById('tzsBtn');

  // Default betting currency: USDT
  let betCurrency = 'USDT';

  function getUser() {
    return JSON.parse(localStorage.getItem("currentUser")) || { deposit: 0 };
  }

  function saveUser(user) {
    localStorage.setItem("currentUser", JSON.stringify(user));
  }

  function formatMoney(amount, currency = 'USDT') {
    if (currency === 'USDT') {
      return `${currency} ${amount.toFixed(2)}`;
    } else if (currency === 'TZS') {
      return `${currency} ${amount.toLocaleString()}`;
    }
    return amount;
  }

  function updateBalanceDisplay() {
    const user = getUser();
    const depositUSDT = user.deposit || 0;
    const depositTZS = depositUSDT * TZS_RATE;
    balanceDisplay.textContent = `Balance: USDT ${depositUSDT.toFixed(2)} | TZS ${depositTZS.toLocaleString()}`;
  }

  function loadMatches() {
    matchesContainer.innerHTML = "";
    matches.forEach(match => {
      const div = document.createElement('div');
      div.className = 'match-card';
      div.innerHTML = `
        <div class="teams"><strong>${match.teamA}</strong> vs <strong>${match.teamB}</strong></div>
        <div class="match-info">${match.time}</div>
        <div class="bet-section">
          <select class="bet-choice">
            <option value="">Select outcome</option>
            <option value="teamA">Win ${match.teamA} (${match.odds.teamA})</option>
            <option value="draw">Draw (${match.odds.draw})</option>
            <option value="teamB">Win ${match.teamB} (${match.odds.teamB})</option>
          </select>
          <input type="number" class="bet-amount" placeholder="Amount (USDT)" min="0.01" step="0.01" />
          <button class="bet-btn">Place Bet</button>
          <div class="result-message"></div>
        </div>
      `;
      matchesContainer.appendChild(div);

      const betBtn = div.querySelector('.bet-btn');
      betBtn.addEventListener('click', () => placeBet(match, div));
    });
    updateBetInputPlaceholders();
  }

  function updateBetInputPlaceholders() {
    const inputs = document.querySelectorAll('.bet-amount');
    inputs.forEach(input => {
      if (betCurrency === 'USDT') {
        input.placeholder = "Amount (USDT)";
        input.min = "0.01";
        input.step = "0.01";
      } else {
        input.placeholder = "Amount (TZS)";
        input.min = "1000";
        input.step = "1";
      }
      input.value = "";
      const message = input.parentElement.querySelector('.result-message');
      if(message) message.textContent = "";
    });
  }

  function placeBet(match, div) {
    const select = div.querySelector('.bet-choice');
    const input = div.querySelector('.bet-amount');
    const message = div.querySelector('.result-message');
    const choice = select.value;
    let amount = betCurrency === 'USDT' ? parseFloat(input.value) : parseInt(input.value);

    if (!choice || isNaN(amount) || amount <= 0) {
      message.textContent = "‚ö†Ô∏è Invalid selection or amount";
      return;
    }

    const user = getUser();
    const depositUSDT = user.deposit || 0;
    const depositTZS = depositUSDT * TZS_RATE;

    // Check balance based on selected currency
    if ((betCurrency === 'USDT' && amount > depositUSDT) ||
        (betCurrency === 'TZS' && amount > depositTZS)) {
      message.textContent = "‚ùå Insufficient balance";
      return;
    }

    // Convert bet amount to USDT for internal calculations and storage
    const amountUSDT = betCurrency === 'USDT' ? amount : amount / TZS_RATE;

    // Simulate loss skew (user has 70% chance to lose)
    const chance = Math.random();
    let actualResult;
    if (chance < 0.7) {
      // Pick a different outcome to user's choice
      const options = ['teamA', 'draw', 'teamB'].filter(opt => opt !== choice);
      actualResult = options[Math.floor(Math.random() * options.length)];
    } else {
      actualResult = choice;
    }

    // Deduct bet amount (in USDT)
    user.deposit = +(user.deposit - amountUSDT).toFixed(6);

    let payoutUSDT = 0;
    if (actualResult === choice) {
      const odds = match.odds[choice];
      payoutUSDT = amountUSDT * odds;
      user.deposit = +(user.deposit + payoutUSDT).toFixed(6);
      message.textContent = `üéâ You won ${formatMoney(betCurrency === 'USDT' ? payoutUSDT : payoutUSDT * TZS_RATE, betCurrency)}!`;
    } else {
      message.textContent = `‚ùå You lost! Result was: ${formatResult(actualResult, match)}`;
    }

    saveUser(user);
    updateBalanceDisplay();

    // Save bet history (store all amounts & payouts in USDT but show formatted)
    const history = JSON.parse(localStorage.getItem("betHistory") || "[]");
    history.unshift({
      date: new Date().toLocaleString(),
      match: `${match.teamA} vs ${match.teamB}`,
      choice: formatResult(choice, match),
      result: formatResult(actualResult, match),
      amountUSDT: amountUSDT,
      payoutUSDT: payoutUSDT,
      currency: betCurrency
    });
    localStorage.setItem("betHistory", JSON.stringify(history));
    renderHistory();
  }

  function formatResult(code, match) {
    if (code === "teamA") return `Win ${match.teamA}`;
    if (code === "teamB") return `Win ${match.teamB}`;
    if (code === "draw") return "Draw";
    return "N/A";
  }

  function renderHistory() {
    const history = JSON.parse(localStorage.getItem("betHistory") || "[]");
    if (history.length === 0) {
      historySection.style.display = "none";
      return;
    }
    historySection.style.display = "block";
    betHistoryList.innerHTML = history.map(item => {
      const amountDisplay = item.currency === 'USDT' ? 
        formatMoney(item.amountUSDT, 'USDT') : 
        formatMoney(item.amountUSDT * TZS_RATE, 'TZS');
      const payoutDisplay = item.currency === 'USDT' ? 
        formatMoney(item.payoutUSDT, 'USDT') : 
        formatMoney(item.payoutUSDT * TZS_RATE, 'TZS');
      return `
        <div class="history-item">
          ${item.date} | ${item.match} | Bet: ${item.choice} | Result: ${item.result} | Amount: ${amountDisplay} | Winnings: ${payoutDisplay}
        </div>
      `;
    }).join("");
  }

  // Handle currency toggle buttons
  usdtBtn.addEventListener('click', () => {
    betCurrency = 'USDT';
    usdtBtn.classList.add('active');
    tzsBtn.classList.remove('active');
    updateBetInputPlaceholders();
  });
  tzsBtn.addEventListener('click', () => {
    betCurrency = 'TZS';
    tzsBtn.classList.add('active');
    usdtBtn.classList.remove('active');
    updateBetInputPlaceholders();
  });

  window.onload = () => {
    updateBalanceDisplay();
    loadMatches();
    renderHistory();
  };
</script>

</body>
</html>