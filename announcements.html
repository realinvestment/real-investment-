<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8">
  <title>Admin - Tuma Taarifa</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .form-section {
      background: white;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    textarea, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      margin-top: 15px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Tuma Notification kwa Mtumiaji</h2>
  <div class="form-section">
    <label>Chagua Mtumiaji:</label>
    <select id="userSelect">
      <option value="all">-- Watumiaji Wote --</option>
    </select>

    <label>Andika Ujumbe:</label>
    <textarea id="message" rows="4" placeholder="Andika ujumbe hapa..."></textarea>

    <button onclick="sendNotification()">Tuma Ujumbe</button>
  </div>

  <script>
    const users = JSON.parse(localStorage.getItem("users")) || [];

    function populateUserList() {
      const select = document.getElementById("userSelect");
      users.forEach(user => {
        const option = document.createElement("option");
        option.value = user.phone;
        option.textContent = `${user.name} (${user.phone})`;
        select.appendChild(option);
      });
    }

    function sendNotification() {
      const selectedPhone = document.getElementById("userSelect").value;
      const message = document.getElementById("message").value.trim();
      if (!message) {
        alert("Tafadhali andika ujumbe.");
        return;
      }

      const notifications = JSON.parse(localStorage.getItem("notifications")) || [];

      const timeNow = new Date().toLocaleString();

      if (selectedPhone === "all") {
        users.forEach(user => {
          notifications.push({ phone: user.phone, message, time: timeNow });
        });
      } else {
        notifications.push({ phone: selectedPhone, message, time: timeNow });
      }

      localStorage.setItem("notifications", JSON.stringify(notifications));
      alert("Ujumbe umetumwa.");
      document.getElementById("message").value = "";
    }

    populateUserList();
  </script>

</body>
</html>