<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Withdraw History with Loss Tracking</title>
  <style>
    body { font-family: Arial, sans-serif; background: #222; color: #eee; padding: 20px; }
    h1 { color: gold; }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      color: white;
    }
    th, td {
      border: 1px solid #555;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #444;
    }
    .loss {
      color: #ff4444;
      font-weight: bold;
    }
    .success {
      color: #4caf50;
      font-weight: bold;
    }
    .failed {
      color: #f44336;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ðŸ“¤ Withdraw History</h1>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Amount Withdrawn (USDT)</th>
        <th>Lost Amount (USDT)</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="withdrawHistoryBody">
      <tr><td colspan="4">Loading...</td></tr>
    </tbody>
  </table>

  <script>
    // Simulate logged in user
    function getUser() {
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));
      const users = JSON.parse(localStorage.getItem("users")) || [];
      if (!currentUser) return null;
      const user = users.find(u => u.phone === currentUser.phone);
      return user || null;
    }

    function saveWithdrawHistory(history) {
      localStorage.setItem("withdrawHistory", JSON.stringify(history));
    }

    function getWithdrawHistory() {
      const user = getUser();
      if (!user) return [];
      let history = JSON.parse(localStorage.getItem("withdrawHistory") || "[]");
      // Filter history only for this user
      return history.filter(h => h.phone === user.phone);
    }

    function renderWithdrawHistory() {
      const history = getWithdrawHistory();
      const tbody = document.getElementById("withdrawHistoryBody");
      if (history.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4">Hakuna historia ya withdrawal.</td></tr>`;
        return;
      }
      tbody.innerHTML = history.map(h => {
        let statusClass = h.status === "Success" ? "success" : (h.status === "Failed" ? "failed" : "");
        return `
          <tr>
            <td>${new Date(h.date).toLocaleString()}</td>
            <td>${h.amount.toFixed(4)}</td>
            <td class="loss">${h.lostAmount.toFixed(4)}</td>
            <td class="${statusClass}">${h.status}</td>
          </tr>
        `;
      }).join("");
    }

    // Example function to add a withdraw entry (you would call this when user withdraws)
    function addWithdrawEntry(amountWithdrawn, lostAmount, status = "Success") {
      const user = getUser();
      if (!user) return;
      let history = JSON.parse(localStorage.getItem("withdrawHistory") || "[]");
      history.push({
        phone: user.phone,
        date: new Date().toISOString(),
        amount: amountWithdrawn,
        lostAmount: lostAmount,
        status: status
      });
      saveWithdrawHistory(history);
      renderWithdrawHistory();
    }

    // Init dummy data if empty (for demo)
    if (!localStorage.getItem("withdrawHistory")) {
      addWithdrawEntry(5, 2, "Success");
      addWithdrawEntry(10, 0, "Failed");
      addWithdrawEntry(3, 1.5, "Success");
    } else {
      renderWithdrawHistory();
    }
  </script>
</body>
</html>